% arara: pdflatex
% arara: nomencl
% arara: pdflatex
\documentclass[a4paper,11pt]{mscThesis}

%
%========================== Packages ======================================
		\usepackage{lipsum} 
		\usepackage{outlines}
		\usepackage{amsmath}
		\usepackage{amssymb}
		\usepackage{tabularx}
		\usepackage{graphicx}
		\usepackage{subfig}
		\usepackage{hhline}
		\usepackage{epstopdf}
		\usepackage{url}
		
		% Acronyms
		\usepackage{acronym}
		%Nomenclature
		\usepackage{nomencl}
		\makenomenclature		
		%Index package
		\usepackage{imakeidx}		
		\makeindex
		
		\renewcommand{\a}[1]{\acs{#1}} %Fastkey \acs{[1]}
		\renewcommand{\v}[1]{\vspace{-#1mm}} 
		\newcommand{\IF}{$\left\lbrace\mathcal{I}\right\rbrace$ }
		\newcommand{\BF}{$\left\lbrace\mathcal{B}\right\rbrace$ }	
		
		%Tabitems
		\usepackage{booktabs}% http://ctan.org/pkg/booktabs
		\newcommand{\tabitem}{~~\llap{\textbullet}~~}
		
		% Bibliography
		\usepackage[utf8]{inputenc}

%================================================================		

\mscDepartment{Delft Center for Systems and Control}
%{Systems and Control}
\mscProgram{Mechanical Engineering} \mscFaculty{Mechanical,
Maritime and Materials Engineering} \mscName{N.N. Vo}
\mscDate{\today} \mscTitle{Geometric Control of a Quadrotor with a Suspended Load} \mscSubTitle{Subtitle}
\mscKeyWords{thesis, msc, subject}
%
%use the next line if you want a picture on the title page
\mscTitlePagePicture{example_titlefig}
%Note: the file example_titlefig.eps is just for illustration. Do not use this for your own thesis

%% --------------------------------------------------------------------
%% THIRD PARTY OPTIONS

%use the next line if you want a text to acknowledge (a) third party/parties on the copyright page
\mscThirdPartyText{The work in Master of Science Thesis was supported by Alten. Their cooperation is hereby gratefully acknowledged.}

%use the next line if you want the logo of a third party on the copyright page
%NOTE: on the title page only the TUDelft and DCSC logo's are permitted. These are automatically created

\mscThirdPartyLogo{./StyleStuff/ALTEN.png}
%Note: the file examplelogo.eps is just for illustration. Do not use this for your own thesis

%% --------------------------------------------------------------------


\mscReaderOne{dr.ir. T. Keviczky}
\mscReaderTwo{ir. B. van Vliet}
%\mscReaderThree{ir. My. Readertwo}
%\mscReaderFour{}
%
\setThesisInfo
%

\begin{document}
%
%============================= Front matter ========================================
\frontmatter %
%
% Make a hell of a lot of title pages
 \maketitle
%
% Abstract
\include{abstract}
%
% Acknowledgements
    \nonumchap{Acknowledgements}%
 %NOG NIET AF
    I would like to thank my supervisors \mscreaderone\ from DCSC and \mscreadertwo\ from Alten Nederland B.V. for their assistance during the writing
    of this thesis. I would also \ldots 
    \vspace*{15mm}

    \noindent
    Delft, University of Technology \hfill \mscname\\
    \mscdate

%
% table of contents, (\toc of \toclof of \tocloflot )
    \tocloflot
%
    
    \cleardoublepage%
%
%============================= Main matter =========================================
%
\mainmatter
%
% Introduction
%\include{examples}
%FROM LITERATURE
%\include{fromLiterature}

\include{introduction}
\include{modeling}
\include{control}

\include{setup_results}
\include{conclusion}
%\include{future_work}

%LATEX TEST
%\include{latex_test}


	
%============================= Appendices=========================================
\appendix
    \chapter{Appendix}
    
    \section{Derivation of LQR controller}
    
	    \subsection{Modeling}\label{app:model}
%	    \section{Classical Modeling}
	    
	    ***************************************\\
	    A traditional modeling method might represent the rotation matrix with a local coordinate system, for example with a Euler Angle parameterization. 
	    
	    ***************************************\\
	    
	    
	    
	    ***************************************\\
	    A commonly used method for modeling a system is via Newton's law and Lagrangian mechanics. 
	    Based on Euler-Lagrange? $ \rightarrow $ Geometric Mechanics\\
	   
	    ***************************************\\
%	    \subsection{Quadrotor-Load Modeling}	
%	    \subsection{Quadrotor Modeling}
		

	    
	    
	    
	    
%	    ***************************************\\
%	    \begin{equation}
%	    ax = 
%	    \begin{bmatrix}
%	    (f*m*sin(\phi_q)*sin(\psi_q) + f*m_l*sin(\phi_q)*sin(\psi_q) - f*m_l*cos(\theta)^2*sin(\phi_q)*sin(\psi_q) + f*m*cos(\phi_q)*cos(\psi_q)*sin(\theta_q) + f*m_l*cos(\phi_q)*cos(\psi_q)*sin(\theta_q) + l*m*m_l*v_\theta^2*cos(\theta)*sin(\phi) + f*m_l*cos(\phi)^2*cos(\theta)^2*sin(\phi_q)*sin(\psi_q) + l*m*m_l*v_\phi^2*cos(\theta)^3*sin(\phi) - f*m_l*cos(\phi_q)*cos(\psi_q)*cos(\theta)^2*sin(\theta_q) + f*m_l*cos(\phi)^2*cos(\phi_q)*cos(\psi_q)*cos(\theta)^2*sin(\theta_q) + f*m_l*cos(\psi_q)*cos(\theta)*sin(\phi)*sin(\phi_q)*sin(\theta) + f*m_l*cos(\phi)*cos(\phi_q)*cos(\theta_q)*cos(\theta)^2*sin(\phi) - f*m_l*cos(\phi_q)*cos(\theta)*sin(\phi)*sin(\psi_q)*sin(\theta_q)*sin(\theta))/(m*(m + m_l))\\
%	    (l*m*m_l*v_\theta^2*sin(\theta) - f*m_l*cos(\psi_q)*cos(\theta)^2*sin(\phi_q) - f*m*cos(\psi_q)*sin(\phi_q) + f*m*cos(\phi_q)*sin(\psi_q)*sin(\theta_q) + f*m_l*cos(\phi_q)*cos(\theta)^2*sin(\psi_q)*sin(\theta_q) + l*m*m_l*v_\phi^2*cos(\theta)^2*sin(\theta) + f*m_l*cos(\phi)*cos(\phi_q)*cos(\theta_q)*cos(\theta)*sin(\theta) - f*m_l*cos(\theta)*sin(\phi)*sin(\phi_q)*sin(\psi_q)*sin(\theta) - f*m_l*cos(\phi_q)*cos(\psi_q)*cos(\theta)*sin(\phi)*sin(\theta_q)*sin(\theta))/(m*(m + m_l))\\
%	    -(g*m^2 + g*m*m_l - f*m*cos(\phi_q)*cos(\theta_q) - f*m_l*cos(\phi_q)*cos(\theta_q) + l*m*m_l*v_\theta^2*cos(\phi)*cos(\theta) + f*m_l*cos(\phi)^2*cos(\phi_q)*cos(\theta_q)*cos(\theta)^2 + l*m*m_l*v_\phi^2*cos(\phi)*cos(\theta)^3 + f*m_l*cos(\phi)*cos(\psi_q)*cos(\theta)*sin(\phi_q)*sin(\theta) - f*m_l*cos(\phi)*cos(\theta)^2*sin(\phi)*sin(\phi_q)*sin(\psi_q) - f*m_l*cos(\phi)*cos(\phi_q)*cos(\theta)*sin(\psi_q)*sin(\theta_q)*sin(\theta) - f*m_l*cos(\phi)*cos(\phi_q)*cos(\psi_q)*cos(\theta)^2*sin(\phi)*sin(\theta_q))/(m*(m + m_l))\\
%	    (- l*m*cos(\theta)*sin(\theta)*v_\phi^2 + f*cos(\psi_q)*cos(\theta)*sin(\phi_q) - f*cos(\phi)*cos(\phi_q)*cos(\theta_q)*sin(\theta) - f*cos(\phi_q)*cos(\theta)*sin(\psi_q)*sin(\theta_q) + f*sin(\phi)*sin(\phi_q)*sin(\psi_q)*sin(\theta) + f*cos(\phi_q)*cos(\psi_q)*sin(\phi)*sin(\theta_q)*sin(\theta))/(l*m)\\
%	    -(f*cos(\phi_q)*cos(\theta_q)*sin(\phi) + f*cos(\phi)*sin(\phi_q)*sin(\psi_q) - 2*l*m*v_\phi*v_\theta*sin(\theta) + f*cos(\phi)*cos(\phi_q)*cos(\psi_q)*sin(\theta_q))/(l*m*cos(theta))
%	    \end{bmatrix}
%	    \end{equation}	    
%	    
%	    ***************************************\\	
	    
	    \subsection{Controller}
	    
    
    \begin{align}\label{eq:state}
    \textbf{x}&=\begin{bmatrix}
    \textbf{q}\\
    \mathbf{\dot{q}}
    \end{bmatrix}\\
    \mathbf{q}&=\begin{bmatrix}
    x&y&z&\phi&\theta&\psi&\theta_L&\psi_L
    \end{bmatrix}^T\\
    \mathbf{\dot{q}}&=\begin{bmatrix}
    \dot{x}&\dot{y}&\dot{z}&\dot{\phi}&\dot{\theta}&\dot{\psi}&\dot{\theta}_L&\dot{\psi}_L
    \end{bmatrix}^T\\
    u&=\begin{bmatrix}
    f&\tau_\phi&\tau_\theta&\tau_\psi
    \end{bmatrix}^T
    \end{align}
    
    \begin{align}\label{eq:ss}
    \mathbf{\dot{x} }&=A\mathbf{x}+Bu\\
    y&=C\mathbf{x}+Du
    \end{align}
    
    %CHECK if needed?
    \begin{equation}\label{key}
    \mathbf{\dot{x}}=\textbf{f}(\mathbf{x,u})
    \end{equation}
    
    %ADD reference
    From Equation follows
    \begin{align}\label{key}
    %CHECK this equations
    \ddot{x}&=-\frac{f}{m}\\
    \ddot{y}&=\\
    \ddot{z}&=
    \end{align}
    
    The mathematical model is linearized around the following operating points
    \begin{align}\label{key}
    \bar{\mathbf{x}}&=\begin{bmatrix}\bar{x}&\bar{y}&\bar{z}&\textbf{0}_{1\times13}\end{bmatrix}^T\\
    \bar{\textbf{u}}&=\begin{bmatrix}
    (m_Q+m_L)g&0&0&0
    \end{bmatrix}^T
    \end{align}
    
    %CHECK are these asssumptions correct?
    Assuming small angles, the following holds
    \begin{align}\label{key}
    \text{for } \gamma &= \phi, \theta, \psi, \theta_L, \psi_L\\
    sin(\gamma)&\simeq \gamma\\
    cos(\gamma)&\simeq 1\\
    \dot{\gamma} &\simeq 0\\
    F &\simeq (m_Q+m_L)g
    \end{align}
    
    \begin{equation}\label{key}
    A=\frac{\partial \textbf{f}(x,u)}{\partial x}\mid _{	x=\bar{x},u=\bar{u}	}
    \end{equation}
    \begin{equation}\label{key}
    B=\frac{\partial \textbf{f}(x,u)}{\partial u}\mid _{	x=\bar{x},u=\bar{u}	}
    \end{equation}
    
    \begin{equation}\label{key}
    u=-K\left[\textbf{x}_{des}(t)-\textbf{x}(t)\right] 
    \end{equation}
    
    \section{Derivation of Equations of motion}
		\subsection{Load Dynamics}\label{sec.app:loaddyn}
		%PROOF prop.3 Sreenath2013a. Also Sreenath2013b?
		%DEFINE e_3 / R / f 
		
		Let \lsymb{$ x_{CM} $}{Position \lsymb{$ CM $}{Center of Mass} of \a{qr}-Load system} denote the position of the center of mass of the combined Quadrotor-Load system, expressed in \IF. Which can be found by
		\begin{align}\label{eq:CM}
		\begin{split}
		m_Q(x_Q-x_{CM})+m_L(x_L-x_{CM})&=0\\
		(m_Q+m_L)x_{CM}&=m_Qx_Q+m_Lx_L
		\end{split}
		\end{align}
		Applying the laws of motion to (\ref{eq:CM}) and inserting (\ref{eq:xQ2xL}) gives the 
		\begin{align}\label{key}
		\begin{split}
		(m_Q+m_L)\ddot{x}_{CM}&=fRe_3 - (m_Q+m_L)ge_3\\
		%&=fRe_3 - (m_Q+m_L)ge_3\\
		%(m_Q+m_L)\ddot{x}_{CM}&=m_Q\ddot{x}_Q + m_L\ddot{x}_L\\
		%\\
		%m_Q\ddot{x}_Q+m_L\ddot{x}_L&=fRe_3 - (m_Q+m_L)ge_3\\
		%m_Q(\ddot{x}_L-L\ddot{q})+m_L\ddot{x}_L&=fRe_3 - (m_Q+m_L)ge_3\\
		(m_Q+m_L)(\ddot{x}_L+ge_3)&= fRe_3+m_QL\ddot{q}
		\end{split}
		\end{align}
		
		%ADD derivation of ddq (TANG2014)

    
    \section{An appendix section}
\begin{equation}\label{key}
Test equation
\end{equation}
    \subsection{A \matlab Listing}

    \lstset{language=matlab}
    \lstinputlisting{test.m}
    
%    \subsection{An appendix subsection with C++ Listing}
%
%    \lstset{language=C++}
%    \lstinputlisting{test.c}    

%    \chapter{Yet another appendix}
%
%    \section{Test section (again?)}
%
%    Ok, all is well.

%============================= Back matter =========================================
\backmatter
	% Bibliography
	\bibliographystyle{ieeetr}
	\bibliography{library}
	
	%CHECK all entries for uniformity 	
	
	\printbib{library}
	
	% Index
	\printindex

	% Nomenclature
	\printnomenclature
\include{glossary}
	% Acronyms
%    \nonumchap{Acronyms}    
%    \begin{acronym}[XXXXX]% Note: replace XXXXX by the longest acronym
%                          %       in your list.
%        \acro{DUT}{Delft University of Technology}%
%    \end{acronym}%

\end{document}
